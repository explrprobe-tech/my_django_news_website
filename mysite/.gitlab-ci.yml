image: python:3.11

stages:
  - test

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ pip –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
cache:
  paths:
    - .cache/pip

before_script:
  - python -V
  - pip install -r requirements.txt

code_validation:
  stage: test
  script:
    - echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ Django..."
    - python manage.py check
    - echo "‚úÖ –ö–æ–¥ –≤–∞–ª–∏–¥–µ–Ω!"

test_suite:
  stage: test
  script:
    - echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã..."
    - python manage.py test
    - echo "‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏!"

migration_check:
  stage: test
  script:
    - echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π..."
    - python manage.py makemigrations --check --dry-run
    - echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ø–æ—Ä—è–¥–∫–µ!"

security_check:
  stage: test
  script:
    - echo "üîí –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏..."
    - python manage.py check --deploy
    - echo "‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞!"